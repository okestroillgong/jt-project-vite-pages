# JT Project (업무용 프론트엔드)

본 프로젝트는 shadcn/ui, Tailwind CSS, Vite + React Router를 사용하여 구축된 친애저축은행의 내부 금융 업무 관리 대시보드입니다.

---

## 1. 기술 스택 (Tech Stack)

- **Build Tool**: Vite 5.4.11
- **Framework**: React 18.3.1 + React Router v7
- **Language**: TypeScript 5+
- **UI**: shadcn/ui, Tailwind CSS v4
- **State Management**: Zustand
- **Font**: Pretendard
- **Icons**: Lucide (기본) + Custom Icons (`/src/assets/icons`)
- **Linting**: ESLint

## 2. 시작하기 (Getting Started)

1. **의존성 설치:**

   ```bash
   npm i
   ```

2. **개발 서버 실행:**

   ```bash
   npm run dev
   ```

   브라우저에서 [http://localhost:3000](http://localhost:3000) 주소로 접속하여 확인할 수 있습니다.

## 3. 주요 스크립트 (Scripts)

- **Linter 실행:**

  ```bash
  npm run lint
  ```

- **타입스크립트 정적 분석:**

  ```bash
  npx tsc --noEmit
  ```

---

## 4. 프로젝트 구조 (Project Structure)

- **`src/`**: 메인 소스 코드 디렉토리입니다.
  - **`src/main.tsx`**: 애플리케이션 진입점입니다.
  - **`src/routes/`**: React Router 기반의 라우트 정의가 위치합니다.
  - **`src/layouts/`**: `RootLayout`, `DashboardLayout`, `PopupLayout` 등 레이아웃 컴포넌트입니다.
  - **`src/pages/`**: 대시보드 및 팝업 페이지 컴포넌트가 위치합니다.
  - **`src/components/app/`**: `Header`, `Sidebar`, `DataTable` 등 애플리케이션의 주요 레이아웃 및 고수준 컴포넌트가 위치합니다.
  - **`src/components/filters/`**: 동적 필터 UI를 구축하기 위한 재사용 가능한 필터 컴포넌트 모음입니다.
  - **`src/components/ui/`**: `Button`, `Input` 등 shadcn/ui에서 제공하는 범용 UI 기본 요소입니다.
  - **`src/assets/`**: 아이콘, 로고 등 정적 에셋 파일입니다.
  - **`src/lib/`**: 유틸리티 함수 및 전역 상태 관리(`Zustand`) 코드가 위치합니다.

## 5. UI/UX 컨벤션

### 5.1. 탭 기반 인터페이스

본 애플리케이션은 여러 페이지를 동시에 열어두고 작업할 수 있는 탭 기반 인터페이스를 채택했습니다.

- **탭 생성**: 사이드바에서 메뉴 항목(2차 또는 3차)을 클릭하면 화면 하단에 해당 페이지에 대한 새 탭이 생성됩니다.
- **탭 관리**: 각 탭은 독립적인 컨텍스트를 유지하며, 탭 우측의 'X' 버튼을 눌러 닫을 수 있습니다. 최대 10개까지 탭을 열 수 있습니다.
- **레이아웃**: 탭 바는 화면 하단에 고정되어 있으며, 활성 탭은 초록색(`emerald`) 테마 색상으로 강조 표시됩니다.

### 5.2. 사이드바 (`src/components/app/Sidebar.tsx`)

- **초기 상태**: 페이지 로드 시, 주 메뉴는 "상담관리"가 선택되며, 2차 사이드바 패널은 **닫힌 상태**로 시작합니다.
- **호버 기능**: 2차 메뉴가 있는 주 메뉴("여신사후" 등)에 마우스를 올리면 해당 2차 사이드바 패널이 나타납니다. 마우스가 사이드바 영역을 벗어나면 패널이 닫힙니다.

### 5.3. 표준화된 컴포넌트 스타일

- **페이지 제목**: 모든 페이지 제목은 `40x40` 크기의 표준 아이콘(`title-icon.webp`)으로 시작하며, 2차 사이드바의 제목과 동일한 스타일(`text-lg font-semibold`)으로 표시됩니다.
- **브레드크럼**: 마지막 항목은 글로벌 CSS 규칙을 통해 자동으로 강조 색상(`#39c375`)이 적용됩니다.
- **테이블 헤더 (`TableHead`)**: 모든 테이블 헤더는 배경색 `#f1f1f1`, 높이 `48px`, `font-semibold text-sm`로 표준화되었습니다.
- **필터 컨테이너**: 모든 필터 컨테이너는 `px-4 py-8` 패딩을 적용하여 일관된 간격을 유지합니다.
- **날짜 필터 형식**: 모든 날짜 선택 필터의 표시 형식은 `yyyy-MM-dd`로 통일되었습니다.
- **읽기 전용(Read-only) 필드**: `readonly` 또는 `disabled`로 설정된 `Input` 및 `Select` 필드는 사용자와의 상호작용이 불가능함을 명확히 나타내기 위해 `bg-gray-2.00` 배경색과 `text-gray-500` 텍스트 색상이 적용됩니다.
- **페이지 내 탭 (`Tabs`)**: 페이지 내부에서 사용되는 탭 컴포넌트(`TabsList`)는 탭 사이의 간격이 제거되어 시각적으로 연결된 디자인을 제공합니다.

### 5.4. `RightActions` 컴포넌트 (`src/components/app/RightActions.tsx`)

- **중앙화된 액션 버튼**: 페이지 우측 상단에 위치하는 조회, 저장, 삭제 등 주요 액션 버튼들의 일관성을 유지합니다.
- **'페이지 새로고침' 기능**: `id: 'reset'` 버튼은 `window.location.reload()`를 호출하는 고정 기능을 수행합니다.
- **'데이터 초기화' 버튼**: `id: 'data-reset'` 버튼은 페이지 새로고침 없이 입력 폼 데이터만 초기화합니다.

#### 5.4.1. 권한에 따른 동적 버튼 표시

- **기능**: 특정 페이지에서 사용자의 권한 레벨에 따라 표시되는 액션 버튼의 종류를 동적으로 변경할 수 있습니다.
- **구현**: 페이지 컴포넌트 내에서 사용자 권한을 확인하고, 해당 권한에 허용된 버튼 `id`의 배열을 생성하여 `RightActions` 컴포넌트의 `actions` prop으로 전달합니다.
- **적용 예시**: `건전성 자료 생성` 페이지에서는 사용자 권한(`Q0001` ~ `Q0006`)에 따라 "지정확인", "감리미의견", "할증차금" 등 각기 다른 버튼 조합이 표시됩니다.

#### 5.4.2. 조건부 테이블 렌더링 연동

- **기능**: `RightActions`의 특정 버튼 클릭 시, 페이지 내의 `DataTable`이 서로 다른 데이터와 컬럼 구조를 가지도록 동적으로 변경하는 기능이 구현되었습니다.
- **구현**: 페이지 컴포넌트에서 어떤 종류의 테이블을 보여줄지 상태(`tableType`)로 관리합니다. "조회", "수정내역" 등 각 버튼의 `onClick` 핸들러는 이 상태를 변경하고, `DataTable`은 해당 상태에 따라 다른 `columns`와 `data` prop을 받아 렌더링됩니다.
- **적용 예시**: `건전성 자료 생성` 페이지에서 "조회" 버튼은 기본 테이블을, "수정내역" 버튼은 "대출잔액" 등의 추가 컬럼이 포함된 테이블을 표시합니다.

---

## 6. 필터 시스템 구현 가이드

본 프로젝트는 간단한 레이아웃부터 복잡한 그리드 기반 레이아웃까지 모두 지원하는 정교한 필터 시스템을 갖추고 있습니다.

### 6.1. 이중 아키텍처 (Dual Architecture)

필터 시스템은 선언적으로 정의된 `filterLayout` 설정에 따라 두 가지 모드로 동작합니다.

1.  **플렉스박스 모드 (Flexbox Mode)**: 단순하고 줄바꿈이 적용되는 필터 행을 위한 레거시 모드입니다. 각 필터 컴포넌트(`FilterInput`, `FilterSelect` 등)가 자체적으로 레이블과 입력 필드를 렌더링합니다.
2.  **그리드 모드 (Grid Mode)**: 정교한 컬럼 기반 레이아웃을 위한 새로운 모드입니다. 중앙 집중화된 `FilterWrapper` 컴포넌트가 모든 필터의 렌더링을 담당하여 완벽한 정렬과 스타일 일관성을 보장합니다.

### 6.2. 필터 DSL(Domain-Specific Language) 정의

필터 레이아웃은 다음과 같은 TypeScript 타입으로 정의된 설정 객체의 배열입니다.

```typescript
// 전체 필터 레이아웃은 여러 행(Row)의 배열로 구성됩니다.
type FilterLayout = FilterRow[];

// 각 행은 필터 배열(플렉스박스 모드) 또는 그리드 설정 객체(그리드 모드)가 될 수 있습니다.
type FilterRow = Filter[] | FilterGridRowConfig;

// 그리드 기반 행의 설정
type FilterGridRowConfig = {
  type: "grid";
  columns: number; // 그리드의 총 컬럼 수
  filters: Filter[]; // 해당 그리드에 배치될 필터 목록
};

// 개별 필터의 정의
type Filter = {
  type: "text" | "number" | "select" | "date" | "checkbox" | "search" | "file" | "date-range" | "number-range" | "blank";
  label?: string;
  width?: "short" | "middle" | "long"; // 텍스트 입력 필드의 너비 (플렉스박스 모드)
  options?: { value: string; label: string }[]; // 선택(select) 필터의 옵션
  activator?: boolean; // 필드를 활성화/비활성화하는 체크박스 추가
  colSpan?: number; // 필터가 차지할 컬럼 수 (그리드 모드)
  readonly?: boolean; // 필드를 읽기 전용으로 설정
  defaultValue?: string; // 필드의 기본값 설정
};
```

### 6.3. 주요 소스 코드

- **`src/components/filters/FilterContainer.tsx`**: `filterLayout` DSL을 받아 각 행의 타입에 따라 플렉스박스 또는 그리드 모드로 렌더링하는 메인 컨테이너입니다.
- **`src/components/filters/FilterGridRow.tsx`**: 그리드 행을 렌더링하며, 동적 클래스 문제를 피하기 위해 인라인 스타일로 그리드 구조를 생성합니다.
- **`src/components/filters/FilterWrapper.tsx`**: **그리드 모드의 핵심 컴포넌트**로, `[레이블] + [입력 필드]` 구조를 강제하여 모든 필터의 정렬을 보장하고, 모든 유효성 검사 규칙을 중앙에서 관리합니다.

---

## 7. 범용 데이터 테이블 (`DataTable`) 도입

애플리케이션 전반의 테이블 구현을 표준화하고 재사용성을 높이기 위해 범용 `DataTable` 컴포넌트가 도입되었습니다. 이로써 여러 페이지에서 개별적으로 관리되던 테이블 로직이 중앙 집중화되어 유지보수성이 향상되었습니다.

### 7.1. 주요 기능

- **동적 컬럼 정의**: `ColumnDef` 타입을 통해 다양한 데이터 구조에 맞춰 유연하게 컬럼을 정의할 수 있습니다.
- **클라이언트 측 정렬**: 모든 컬럼에 대해 오름차순, 내림차순, 정렬 취소의 일관된 순서로 정렬 기능을 제공합니다. 컬럼 헤더 클릭 시 정렬 방향에 따라 아이콘이 동적으로 변경됩니다.
- **페이지네이션**: 한 페이지에 최대 10개의 행을 표시하며, 첫 페이지, 이전 페이지, 페이지 번호, 다음 페이지, 마지막 페이지로 이동할 수 있는 직관적인 페이지네이션 컨트롤을 제공합니다.
- **자동 데이터 포맷팅**:
    - **금액**: `amountColumns` 속성에 컬럼 ID를 배열로 전달하면, 해당 컬럼의 숫자 값이 자동으로 `toLocaleString()`을 통해 세 자리 쉼표가 포함된 형식으로 변환됩니다. 재귀적 탐색을 통해 중첩된 컬럼 구조에서도 올바르게 동작합니다.
    - **날짜**: `dateColumnConfig` 속성에 `{ 컬럼ID: 'YYYYMMDD' }`와 같이 원본 데이터 형식을 명시하면, 해당 컬럼의 값이 `yyyy-MM-dd` 형식으로 자동 변환됩니다. 이 방식은 의도치 않은 데이터 변환을 방지합니다.
- **데이터 정렬**: 모든 테이블 셀의 데이터는 기본적으로 좌측 정렬됩니다.
- **헤더 스타일**:
    - 테이블 헤더의 높이는 `48px`로 조정되었으며, 폰트 크기는 `text-sm` (`14px`)로 설정되고 `font-semibold`로 굵게 표시됩니다.
    -   **멀티 레벨 헤더 스타일**: 그룹 헤더(상위 헤더)의 경우 `bg-[#dddddd]` 배경색과 `border-x-[3px] border-[#f1f1f1]` 테두리를 적용하여 시각적으로 구분되도록 했습니다. 또한, 그룹 헤더가 없는 일반 컬럼의 상단 빈 공간(Placeholder)에는 테두리를 제거하여 깔끔한 레이아웃을 제공합니다.
    
    ### 7.3. 테이블 패딩 표준화 (DataTable)
    
    *   `DataTable` 컴포넌트의 모든 테이블 헤더(`TableHead`)와 셀(`TableCell`)에 `minWidth` prop의 유무와 관계없이 `px-4` 패딩을 항상 적용하도록 수정했습니다. 이로써 모든 테이블 셀이 일관된 가로 패딩을 가지게 되어 시각적 일관성이 향상되었습니다.
    
    ### 7.2. 적용 페이지
    
    -   **채권조회 페이지 (`/after-loan/bond-adjustment/bond-inquiry`)**:
        -   "채무관련 조회" 탭과 "엑셀파일 저장" 탭의 테이블이 `DataTable` 컴포넌트로 통합되었습니다.
    - "엑셀파일 저장" 탭의 테이블에 "가상계좌번호" 컬럼이 추가되었습니다.

- **신용회복관리 페이지 (`/after-loan/bond-adjustment/credit-recovery`)**:
    - "당행" 테이블이 `DataTable` 컴포넌트로 통합되었습니다.
    - API 응답 데이터 구조에 맞춰 테이블의 데이터 타입과 컬럼 정의가 업데이트되었으며, "고객번호" 및 "상품명" 컬럼이 추가되었습니다.
    
- **특수채권관리대장 페이지 (`/after-loan/special-bond/management-ledger`)**:
    - 멀티 레벨 헤더를 적용하여 "편입당시 채권내용", "채권회수내용" 등의 그룹화된 정보를 구조적으로 표시합니다.

---

## 8. 코드 품질 및 타입 안전성

모든 코드는 타입스크립트 오류가 없어야 합니다. 커밋하기 전, 다음 명령어를 실행하여 프로젝트 전체의 타입 체크를 통과하는지 확인해주세요.

```bash
npx tsc --noEmit
```

---

## 9. 탭별 페이지 상태 및 테이블 데이터 임시 저장 (Zustand + IndexedDB)

사용자 경험을 향상시키기 위해, 각 탭(페이지)의 고유한 상태(필터 값, 테이블 데이터 등)를 유지하고 브라우저 세션 간에도 지속되도록 하는 기능이 구현되었습니다. 이 기능은 `Zustand`를 인메모리 상태 관리자로, `IndexedDB` (Dexie.js 라이브러리 활용)를 영구 저장소로 결합하여 작동합니다.

### 9.1. 주요 특징

-   **상태 지속성**: 탭을 닫았다가 다시 열거나, 브라우저를 새로고침해도 페이지의 필터 설정이나 임시 저장된 테이블 데이터가 유지됩니다.
-   **탭별 독립성**: 각 탭은 완전히 독립적인 상태를 가지므로, 여러 탭에서 동시에 작업해도 서로의 상태에 영향을 주지 않습니다.
-   **성능 최적화**: IndexedDB에 대한 쓰기 작업은 디바운싱(debouncing) 처리되어 불필요한 데이터베이스 접근을 줄이고 애플리케이션 성능을 최적화합니다.

### 9.2. 구현 상세

-   **`src/lib/db.ts`**: IndexedDB 데이터베이스(`jt-project-db`)와 `pageStates` 테이블을 정의합니다. `pageStates` 테이블은 각 페이지의 경로(`tabId`)를 키로 사용하여 페이지 상태 객체를 저장합니다.
-   **`src/lib/store/pageStore.ts`**: 현재 활성화된 페이지의 상태를 관리하는 Zustand 스토어입니다. IndexedDB에서 상태를 불러오고(`loadState`), 변경된 상태를 저장하며(`saveState`, `updateFilters`), 탭이 닫힐 때 상태를 삭제하는(`clearState`) 기능을 제공합니다.
-   **`src/components/app/Sidebar.tsx`**: 사이드바 메뉴 클릭 시, 해당 페이지의 탭을 열고 IndexedDB에서 저장된 상태를 불러오도록 연동되었습니다.
-   **`src/components/app/DashboardTabs.tsx`**: 탭 클릭 시 해당 탭의 상태를 불러오고, 탭 닫기 시 IndexedDB에서 해당 탭의 상태를 삭제하도록 연동되었습니다.
-   **필터 컴포넌트 (`src/components/filters/`)**: 모든 필터 컴포넌트가 외부에서 `value`와 `onChange`를 받아 상태를 제어하는 '제어 컴포넌트'로 리팩토링되었습니다. `FilterLayout` 정의에 `name` 속성이 추가되어 각 필터의 상태를 고유하게 식별합니다.
-   **페이지 컴포넌트 연동**: `src/pages/dashboard/after-loan/bond-adjustment/bond-inquiry/index.tsx`와 같은 페이지 컴포넌트에서 `usePageStore`를 사용하여 필터의 현재 상태를 가져오고, 변경 사항을 `updateFilters` 액션을 통해 IndexedDB에 반영합니다.

### 9.3. 사용 예시

`채권조회` 페이지 (`/after-loan/bond-adjustment/bond-inquiry`)에서 필터 값을 입력한 후, 다른 탭으로 이동하거나 브라우저를 새로고침해도 이전에 입력했던 필터 값이 그대로 유지되는 것을 확인할 수 있습니다.

---

## 10. 고급 상태 관리 및 UI 개선

### 10.1. 테이블 데이터 영속성

-   **기능**: "조회" 버튼을 통해 불러온 테이블 데이터는 이제 탭별로 `IndexedDB`에 저장됩니다.
-   **사용자 경험**: 다른 탭으로 이동했다가 돌아오거나 브라우저를 새로고침해도, 이전에 조회했던 테이블 데이터가 그대로 유지되어 다시 조회할 필요가 없습니다.
-   **구조**: 한 페이지 내에 여러 테이블이 존재할 경우를 대비하여, 각 테이블의 데이터를 고유 ID(`'bondInquiryTable'`, `'excelUploadTable'`)로 구분하여 저장합니다.

### 10.2. 전역 로딩 인디케이터

-   **기능**: 페이지 상태를 `IndexedDB`에서 불러오는 동안, 화면 중앙에 세련된 로딩 스피너가 표시됩니다.
-   **사용자 경험**: 새로고침 시 "Loading..." 텍스트 대신 시각적인 인디케이터를 보여주어 로딩 중임을 명확하게 인지할 수 있습니다. 로딩 UI는 `DashboardLayout`에서 중앙 관리됩니다.

### 10.3. 서버 측 로그 (개발용)

-   **기능**: 탭별 상태가 `IndexedDB`에서 로드되거나 저장될 때, `npm run dev`를 실행한 터미널에 해당 내용이 기록됩니다.
-   **목적**: 개발자가 데이터 흐름을 실시간으로 추적하고 디버깅을 용이하게 하기 위한 기능입니다. 객체 데이터는 터미널에서 축약 없이 전체 내용이 표시됩니다.

### 10.4. 버그 수정 및 안정성 향상

-   필터의 활성화(`activator`) 체크박스가 정상적으로 동작하지 않던 문제를 수정했습니다.
-   브라우저 새로고침 시 탭 상태가 초기화되어 페이지가 로드되지 않던 문제를 `localStorage`를 이용한 탭 정보 복원을 통해 해결했습니다.
-   "데이터 초기화" 버튼 클릭 시, 페이지 상태가 `null`로 설정되어 무한 로딩 스피너가 표시되던 문제를 수정했습니다. 이제 초기화 시 즉시 빈 상태로 복원됩니다.
-   날짜 선택 필터(`Button` 기반)의 `readonly` 상태 스타일이 다른 `Input` 필드와 동일하게 표시되도록 수정하여 UI 일관성을 확보했습니다.
-   프로젝트 전체의 타입스크립트 오류를 해결하여 코드 안정성을 높였습니다.

---

## 11. 인터랙티브 테이블 및 데이터 관리

### 11.1. 테이블 Row 클릭 이벤트

-   **기능**: `DataTable` 컴포넌트에 `onRowClick` 이벤트 핸들러가 추가되어, 특정 테이블의 Row 클릭 시 맞춤형 동작을 실행할 수 있습니다.
-   **사용자 경험**: 클릭된 Row는 에메랄드 색상으로 하이라이트되어 사용자가 현재 선택한 항목을 명확하게 인지할 수 있습니다.
-   **적용 예시**: `신용회복관리` 페이지에서는 상단 테이블의 Row를 클릭하면, 해당 데이터와 연관된 상세 정보가 API 요청(현재는 시뮬레이션)을 통해 하단의 "신용회복 원장정보" 폼에 자동으로 채워집니다.

### 11.2. 데이터 초기화 기능

-   **전체 초기화 (페이지 새로고침)**: 브라우저를 새로고침하거나 창을 닫을 때, 혹은 우측 상단의 "페이지 새로고침" 버튼을 클릭하면 열려있던 모든 탭이 닫히고 `localStorage`와 `IndexedDB`에 저장된 모든 데이터가 삭제됩니다. 이를 통해 사용자는 항상 깨끗한 상태에서 세션을 시작할 수 있습니다.
-   **탭별 데이터 초기화**: "데이터 초기화" 버튼은 현재 활성화된 탭의 필터 값과 테이블 데이터만 초기화합니다. 다른 탭의 데이터에는 영향을 주지 않아, 특정 페이지만 빠르고 간편하게 초기 상태로 되돌릴 수 있습니다.

---

## 12. 신규 필터 타입 및 페이지 구현

### 12.1. 입력-버튼 필터 (`input-button`)

-   **기능**: 일반적인 입력 필드 우측에 텍스트 버튼이 결합된 형태의 새로운 필터 타입(`input-button`)이 추가되었습니다.
-   **유연성**: `filterLayout` 정의 시 `buttonText`와 `onButtonClick` 속성을 통해 버튼의 텍스트와 클릭 시 실행될 함수를 자유롭게 지정할 수 있습니다.
-   **적용 예시**: `개인회생관리` 페이지의 "미처리금액" 필터에 적용되어, 특정 로직을 수행하는 버튼을 필터 내에 포함시키는 기능을 구현했습니다.

### 12.2. 개인회생관리 페이지

-   **기능**: `여신사후 > 채권조정` 메뉴 하위에 신규 페이지인 `개인회생관리` 페이지가 추가되었습니다.
-   **구조**: 페이지는 상단의 조회 필터, 중간의 데이터 테이블, 하단의 상세 정보 탭(`개인회생 원장정보`)으로 구성되어 있으며, `신용회복관리` 페이지와 유사한 사용자 경험을 제공합니다.
-   **특징**: `readonly` 속성, `input-button` 타입 등 다양한 종류의 필터가 포함된 복잡한 폼 레이아웃을 구현하여 필터 시스템의 확장성을 보여줍니다.
---

## 13. 사용자 확인 및 세션 관리 개선

### 13.1. 위험한 작업에 대한 명시적 확인

-   **"데이터 초기화" 확인**: 이제 모든 페이지의 "데이터 초기화" 버튼을 클릭하면, 작업을 계속할지 묻는 커스텀 확인 토스트가 화면 중앙 상단에 나타납니다. 사용자가 "예"를 클릭해야만 해당 페이지의 데이터가 초기화되어, 실수로 인한 데이터 유실을 방지합니다.
-   **세련된 토스트 UI**: 확인 토스트는 가독성이 높은 디자인(반투명 배경, 굵은 제목, 명확한 부제, 그림자 효과)으로 개선되었습니다.

### 13.2. 일관된 브라우저 이탈 처리

-   **브라우저 기본 확인창 사용**: F5 키, 브라우저 새로고침 버튼, 탭/창 닫기 등 모든 브라우저 이탈 시도 시에는 브라우저가 기본으로 제공하는 확인 대화상자가 일관되게 사용됩니다.
-   **"취소" 동작 버그 수정**: 확인 대화상자에서 "취소"를 눌렀을 때 데이터가 삭제되던 심각한 버그를 수정했습니다. 이제 "취소"를 누르면 현재 작업 상태가 안전하게 유지됩니다.

### 13.3. 세션 기반 스토리지 초기화

-   **새 세션 시작 시 초기화**: `localStorage`와 `IndexedDB`에 저장된 모든 데이터는 브라우저를 완전히 닫았다가 **새로운 세션을 시작할 때만** 초기화됩니다.
-   **새로고침 시 데이터 보존**: 같은 세션 내에서 페이지를 새로고침할 경우, 모든 탭과 데이터는 그대로 유지되어 작업의 연속성을 보장합니다.

---

## 14. 팝업 시스템 구현 및 UX 개선

### 14.1. 새 창(Window) 기반 팝업 시스템

-   **기능**: 기존의 모달(Modal) 방식 대신, `window.open`을 사용하여 완전히 독립된 새 브라우저 창으로 팝업을 여는 기능이 구현되었습니다. 이는 복잡한 UI를 가진 기능을 메인 화면과 분리하여 제공하기 위함입니다.
-   **전용 라우트**: 팝업 콘텐츠를 위한 전용 경로(`src/pages/popup/`)와 레이아웃(`src/layouts/PopupLayout.tsx`)이 생성되었습니다. 이 레이아웃은 메인 애플리케이션의 헤더나 사이드바를 포함하지 않아 팝업에 최적화된 UI를 제공합니다.
-   **적용 예시**: `RightActions`의 "문서검색" 버튼 클릭 시, `/popup/document-search` 페이지가 새 창으로 열립니다.

### 14.2. 사용자 경험(UX) 개선

-   **확인 절차 제거**: 사용자의 빠른 작업을 위해, 페이지 새로고침이나 "데이터 초기화" 버튼 클릭 시 나타나던 확인 대화상자(Confirm Toast)가 모두 제거되었습니다. 이제 해당 작업들은 즉시 실행됩니다.
-   **세션 데이터 자동 삭제**: 데이터 보안과 일관성을 위해, 브라우저 탭이나 창을 닫을 때(`beforeunload` 이벤트) `localStorage`와 `IndexedDB`에 저장된 모든 세션 데이터(탭 목록, 페이지 상태 등)가 자동으로 삭제되도록 로직이 변경되었습니다.

### 14.3. 필터 시스템 리팩토링 및 안정화

-   **스타일 통일**: 기존에 `grid` 레이아웃과 일반 행 레이아웃 간에 다르게 표시되던 필터 스타일(특히 `date-range` 필터) 문제를 해결했습니다. `FilterContainer`가 모든 필터를 `FilterWrapper` 컴포넌트를 통해 렌더링하도록 리팩토링하여, 어떤 레이아웃 모드에서든 필터가 일관된 UI를 갖도록 개선했습니다.
-   **레이아웃 안정성**: `FilterWrapper`의 너비 스타일을 `w-full`에서 `flex-1`으로 변경하여, 일반 행 레이아웃에서 필터들이 한 줄을 모두 차지하던 문제를 해결했습니다. 이제 필터들은 공간에 따라 유연하게 자동 줄바꿈됩니다.
-   **버그 수정**: 컴포넌트 `import` 방식의 오류로 인해 필터가 렌더링되지 않던 심각한 버그를 수정하여 시스템 안정성을 확보했습니다.

---

## 15. 고급 UI 기능 및 개선

### 15.1. 데이터 테이블(DataTable) 구조 개선

-   **페이지네이션 고정**: 데이터가 많은 테이블에서 세로 스크롤 시, 페이지네이션(페이지 번호) 컨트롤이 스크롤되지 않고 항상 하단에 고정되도록 `DataTable` 컴포넌트의 구조가 개선되었습니다.
-   **헤더 고정**: 세로 스크롤 시 테이블의 헤더가 항상 상단에 고정(`sticky`)되어 표시되므로, 사용자가 컬럼을 쉽게 식별할 수 있습니다.
-   **가로 스크롤 지원**: 테이블의 컬럼이 많아 화면 너비를 초과할 경우, 테이블 영역에 가로 스크롤이 자동으로 생성되어 모든 데이터를 확인할 수 있습니다.

### 15.2. 문서검색 팝업 UI 개선

-   **레이아웃 최적화**: "문서검색" 팝업의 전체적인 레이아웃(탭, 필터, 버튼, 테이블 간 간격)이 사용자가 더 편리하게 정보를 탐색할 수 있도록 세밀하게 조정되었습니다.
-   **일관된 버튼 디자인**: 팝업 내의 "조회", "초기화" 버튼이 일관된 회색 계열의 디자인으로 통일되어 시각적 안정성을 높였습니다.
-   **필터 옵션 업데이트**: "문서목록 구분" 필터의 선택 옵션이 실제 업무 요건에 맞게 "사전조회(상담), 신청, 심사, 전체"로 변경되었습니다.

---

## 16. 신규 기능 및 컴포넌트 개선

### 16.1. 건전성 자료 생성 페이지

-   **신규 페이지**: `여신사후 > 자산건전성/대손상각` 메뉴 하위에 "건전성 자료 생성" 페이지가 추가되었습니다.
-   **동적 레이아웃**: 페이지 내 "조회" 탭과 "생성" 탭의 선택 상태에 따라 좌측(`LeftActions`)과 우측(`RightActions`)의 버튼 목록 및 필터 영역이 동적으로 변경되는 기능이 구현되었습니다.

### 16.2. 컴포넌트 기능 확장

-   **드롭다운 버튼 (`LeftActions`)**: `LeftActions` 컴포넌트에 `DropdownMenu`를 활용한 "확정" 버튼이 추가되었습니다. 선택된 값은 페이지 상태(`confirmStatus`)와 연동되어 저장 및 복원이 가능합니다.
-   **파일 업로드 필터 (`FilterFileUpload`)**: 기존의 파일 업로드 필터에 `buttons` prop이 추가되어, "찾아보기", "등록", "실행" 버튼 중 필요한 버튼만 선택적으로 표시할 수 있도록 기능이 확장되었습니다.
-   **신규 액션 버튼 (`RightActions`)**: `RightActions` 컴포넌트에 "엑셀생성" 버튼이 추가되고, 다른 버튼과 겹치지 않는 아이콘이 할당되었습니다.

### 16.3. UI/UX 및 성능 개선

-   **탭 배경 제거**: 공용 `Tabs` 컴포넌트(`tabs.tsx`)에서 `TabsList`의 기본 배경색이 제거되어 UI가 더 깔끔하게 개선되었습니다.
-   **사이드바 표시 순서**: 2차 사이드바의 `z-index` 값이 조정되어, 다른 콘텐츠에 가려지지 않고 항상 위에 표시되도록 수정되었습니다.
-   **페이지 전환 속도**: 페이지 이동 시 불필요하게 중복 호출되던 데이터 로딩 로직을 제거하여, 탭 전환 및 페이지 이동 속도가 향상되었습니다.
-   **사이드바-탭 연동 개선**:
    -   **컨텍스트 기반 메뉴 펼침**: 이제 "여신사후" 2차 사이드바를 열 때, 현재 활성화된 탭(페이지)이 속한 하위 메뉴(예: "재산건전성/대손상각")가 자동으로 펼쳐져 표시됩니다.
    -   **지능적인 상태 관리**: 만약 현재 활성화된 탭이 "여신사후"와 관련 없는 페이지(예: "신용정보")일 경우, 2차 사이드바의 모든 하위 메뉴는 닫힌 상태로 표시되어 사용자에게 혼란을 주지 않습니다.

---



## 17. 팝업 시스템 개선 및 전역 필터 로직
### 17.1. 고객검색 팝업

-   **신규 팝업**: `long-search` 타입의 "고객번호" 필터와 연동되는 "고객검색" 팝업(`app/popup/customer-search`)이 추가되었습니다.
-   **데이터 전달**: 메인 페이지의 "고객번호" 필드에 입력된 값은 URL 파라미터를 통해 팝업으로 전달되어, 팝업 내 필드의 초기값으로 사용됩니다.
-   **유연한 설계**: 팝업은 `customerNumber` 외 다양한 URL 파라미터를 받아 처리할 수 있도록 유연하게 설계되었습니다.

### 17.2. 중앙화된 팝업 호출 로직

-   **자동화**: `FilterWrapper.tsx` 컴포넌트가 `label: "고객번호"`와 `type: "long-search"` 조건을 만족하는 모든 필터를 감지하여, 해당 필터에 "고객검색" 팝업 호출 기능을 **자동으로 주입**합니다.
-   **유지보수성**: 이 중앙화된 접근 방식 덕분에, 여러 페이지에 걸쳐 동일한 필터에 팝업 기능을 적용하기 위해 각 페이지를 개별적으로 수정할 필요가 없어졌습니다.

### 17.3. 팝업 UI 표준화

-   **팝업 전용 버튼 (`PopupRightActions`)**: 아이콘 대신 텍스트를 사용하는 팝업 전용 액션 버튼 컴포넌트(`components/app/PopupRightActions.tsx`)가 새로 생성되었습니다.
-   **일관성**: "고객검색"과 "문서검색" 팝업 모두 이 새로운 컴포넌트를 사용하도록 리팩토링되어, 모든 팝업의 버튼 스타일과 레이아웃(좌측 타이틀, 우측 버튼, 하단 구분선)이 통일되었습니다.
-   **탭 폰트 크기**: 전역 `Tabs` 컴포넌트(`tabs.tsx`)의 폰트 크기가 `text-base`에서 `text-sm`으로 한 단계 축소되어, UI가 더 정돈된 느낌을 주도록 개선되었습니다.

---

## 18. 고급 팝업 시스템 및 연동

애플리케이션의 복잡한 요구사항을 충족하기 위해 팝업 시스템이 대폭 확장 및 개선되었습니다. 여러 종류의 팝업이 신규 생성되었고, 팝업 간 상호작용 및 메인 페이지와의 데이터 교환 로직이 정교하게 구현되었습니다.

### 18.1. 신규 팝업 생성

-   **부점관리 팝업 (`/popup/branch-management`)**: 부점 정보를 검색하고 선택하는 기능을 제공합니다.
-   **거래내역조회 팝업 (`/popup/transaction-history`)**: 특정 계좌의 상세 거래 내역을 복잡한 레이아웃(필터, 원장정보, 테이블, 합계)으로 조회하는 기능을 제공합니다.
-   **문서스캔 팝업 (`/popup/document-scan`)**: 문서 목록과 뷰어를 가로로 분할된 레이아웃으로 제공하며, 다양한 문서 처리 액션 버튼을 포함합니다.
-   **수정내역 팝업 (`/popup/modification-history`)**: 고객번호와 계좌번호를 기반으로 변경 이력을 조회하는 팝업입니다. "파산면책관리" 및 "개인회생관리" 페이지와 연동됩니다.
-   **채권조정 및 법무진행 조회 팝업 (`/popup/bond-legal-progress`)**: 주민번호를 기반으로 채권조정 및 법무진행 내역을 조회하는 팝업입니다. "건전성 자료 생성" 페이지의 테이블 더블 클릭 이벤트와 연동됩니다.

### 18.2. 아키텍처 개선

-   **팝업 크기 및 위치 중앙화**: 모든 팝업의 크기(1600x800)와 화면 중앙 위치를 `src/layouts/PopupLayout.tsx`에서 `useEffect`를 통해 자동으로 관리합니다. 이로 인해 `window.open` 호출 시 크기 관련 인자를 반복적으로 명시할 필요가 없어졌습니다.
-   **중첩 팝업 (Popup Chaining)**: 팝업 내에서 또 다른 팝업을 호출하는 기능이 구현되었습니다. 대표적으로 `문서검색` 팝업 내에서 `고객검색` 및 `부점관리` 팝업을 호출하여 데이터를 받아오는 기능이 구현되었습니다.

### 18.3. 핵심 컴포넌트 기능 확장

-   **`DataTable.tsx`**: `onRowDoubleClick` 이벤트 핸들러가 추가되어, 테이블의 행을 더블클릭했을 때 특정 동작(주로 팝업에 데이터 전달)을 실행할 수 있게 되었습니다.
-   **`FilterWrapper.tsx`**:
    -   `search` 타입 필터의 돋보기 아이콘에 `onClick` 기능이 추가되어, `onButtonClick` prop을 통해 팝업을 호출할 수 있게 되었습니다.
    -   `className` prop을 지원하도록 수정되어, `FilterLayout` 정의 시 개별 필터에 `w-full`과 같은 커스텀 스타일을 직접 주입할 수 있게 되었습니다.
-   **`FilterLongSearch.tsx`**: `readonly` 상태이더라도 입력 값이 존재하면 검색 버튼이 활성화되도록 로직이 개선되었고, `cursor-pointer`와 `hover` 효과가 추가되어 사용자 경험이 향상되었습니다.
-   **`types.ts` (`Filter` 타입)**:
    -   `defaultValue`의 타입이 `any`로 변경되어, `{ code: '...', name: '...' }`와 같은 객체 형태의 기본값 설정이 가능해졌습니다.
    -   `onButtonClick`의 타입이 `(value?: any) => void`로 변경되어, 버튼 클릭 시 현재 필터의 값을 핸들러로 전달할 수 있게 되었습니다.

### 18.4. 팝업 연동 상세

-   **채권조회**: `성명`(`search`) 필터에서 `고객검색` 팝업을 호출하고, 선택된 고객의 `고객명`과 `고객번호`를 받아 필드를 채웁니다.
-   **신용회복관리**:
    -   `대상자생년월일`(`long-search`) 필터에서 `고객검색` 팝업을 호출하고, 선택된 고객의 `실명번호` 앞 6자리를 `YYYY-MM-DD` 형식으로 변환하여 필드에 채웁니다.
    -   `고객번호`(`long-search`) 필터에서 `고객검색` 팝업을 호출하고, 선택된 고객의 `고객명`과 `실명번호`를 각각 `채무자명`, `주민등록번호` 필드에 매핑하여 채웁니다.
-   **건전성 자료 생성**:
    -   `고객번호`(`long-search`) 필터에서 `고객검색` 팝업 호출 시 `계좌번호`를 함께 파라미터로 전달하며, 선택된 고객의 `고객번호`와 `계좌번호`를 받아 필드를 채웁니다.
    -   `관리부점`(`search`) 필터에서 `부점관리` 팝업을 호출하고, 선택된 부점의 `부점코드`와 `부점명`을 받아 필드를 채웁니다.
    -   **테이블 더블 클릭**: 조회 내용 테이블의 행을 더블 클릭하면 `채권조정 및 법무진행 조회` 팝업이 호출됩니다.
-   **개인회생관리**: 
    -   `납입내역` 탭의 `거래내역` 버튼 클릭 시, 현재 조회된 고객의 `계좌번호`를 파라미터로 `거래내역조회` 팝업을 호출합니다.
    -   `납입내역` 탭의 `수정내역` 버튼 클릭 시, `수정내역` 팝업을 호출합니다.
-   **파산면책관리**: `수정내역` 버튼 클릭 시, 현재 조회된 고객번호와 계좌번호를 파라미터로 `수정내역` 팝업을 호출합니다.
-   **문서검색 팝업 (중첩)**:
    -   `고객번호`(`long-search`) 필터에서 `고객검색` 팝업을 호출하고, `고객번호`와 `계좌번호`를 받아 필드를 채웁니다.
    -   `부점코드`(`search`) 필터에서 `부점관리` 팝업을 호출하고, `부점코드`와 `부점명`을 받아 필드를 채웁니다.

### 18.5. 주요 버그 수정 및 개발 패턴

-   **스코프 문제 해결**: `filterLayout` 정의를 React 컴포넌트 함수 **내부로 이동**시켜, `onButtonClick`과 같은 콜백 함수가 `updateFilters`, `currentState` 등 컴포넌트의 상태와 함수에 정상적으로 접근(클로저)할 수 있도록 수정했습니다. 이는 팝업 연동 시 발생하던 `... is not defined` 오류를 해결하는 핵심 패턴입니다.
-   **타입스크립트 오류 해결**: `npx tsc --noEmit` 명령을 통해 발견된 모든 타입 오류를 수정하여 코드의 안정성과 신뢰성을 확보했습니다.
---

## 19. 안정적인 팝업 연동 가이드라인

메인 페이지와 `window.open`으로 생성된 팝업 간의 데이터 통신은 React의 생명주기와 상태 관리의 복잡성으로 인해 여러 잠재적인 문제를 야기할 수 있습니다. 특히 페이지 초기 로드 시 발생하는 데이터 전달 실패 문제를 해결하고, 향후 안정적인 팝업 기능을 구현하기 위해 `BroadcastChannel` API를 사용하는 새로운 표준 방법론을 도입합니다.

### 19.1. 기존 방식의 문제점

-   **`window.opener` 참조의 불안정성**: 팝업에서 `window.opener`를 통해 메인 페이지의 `window` 객체에 접근하는 방식은, 메인 페이지의 리렌더링 과정에서 참조가 유실되거나 오래된(stale) 참조를 가리킬 위험이 있습니다.
-   **클로저(Closure) 문제**: 메인 페이지에서 콜백 함수를 `window` 객체에 할당할 때, 해당 함수는 생성 시점의 상태(`state`)와 함수(`setState`)를 기억합니다. 만약 메인 페이지가 리렌더링되어 새로운 상태와 함수를 갖게 되더라도, 팝업이 들고 있는 콜백은 여전히 과거의 것을 참조하여 상태 업데이트가 정상적으로 이루어지지 않는 문제가 발생합니다.

### 19.2. 새로운 표준: `BroadcastChannel`을 이용한 메시지 기반 통신

`BroadcastChannel`은 동일 출처(origin)의 브라우저 컨텍스트(탭, 창, iframe 등) 간에 메시지를 안정적으로 주고받을 수 있는 웹 표준 API입니다. 이 방식은 메인 페이지와 팝업이 서로를 직접 참조할 필요 없이, 완전히 분리된(decoupled) 상태에서 통신할 수 있게 해줍니다.

### 19.3. 구현 방법론 (Step-by-Step)

#### 1단계: 메인 페이지 (팝업 호출 페이지)

1.  **메시지 리스너 설정**: `useEffect` 훅을 사용하여 `BroadcastChannel`로부터 메시지를 수신 대기합니다. `lib/popup-bus.ts`에 준비된 유틸리티 함수를 사용합니다.

    ```tsx
    import { useEffect } from "react";
    import { usePathname } from "@/lib/hooks/useAppLocation";
    import { usePageStore } from "@/lib/store/pageStore";
    import { listenForPopupMessages } from "@/lib/popup-bus";

    export default function MyPage() {
      const tabId = usePathname();
      const { updateFilters } = usePageStore();

      useEffect(() => {
        // 메시지 핸들러 정의
        const handlePopupMessage = (message) => {
          // 이 탭을 위한 메시지인지 확인
          if (message.targetTabId !== tabId) return;

          // 어떤 팝업에서 온 메시지인지 확인하여 분기 처리
          if (message.source === 'customer-search') {
            const customer = message.payload;
            updateFilters(tabId, { customerName: customer.customerName });
          }
        };

        // 리스너 등록 및 클린업 함수 저장
        const cleanup = listenForPopupMessages(handlePopupMessage);

        // 컴포넌트 언마운트 시 리스너 정리
        return cleanup;
      }, [tabId, updateFilters]);

      // ...
    }
    ```

2.  **팝업 호출**: `window.open`을 호출할 때, URL 쿼리 파라미터에 현재 페이지의 `tabId`를 `openerTabId`라는 이름으로 반드시 포함시켜야 합니다.

    ```tsx
    const handleOpenPopup = () => {
      const tabId = usePathname(); // 현재 페이지의 경로 (useAppLocation 훅 사용)
      window.open(
        `/popup/customer-search?openerTabId=${tabId}`,
        'CustomerSearch',
        'width=1600,height=800'
      );
    };
    ```

#### 2단계: 팝업 페이지

1.  **`tabId` 추출 및 데이터 전송**: `useSearchParams`를 사용해 URL에서 `openerTabId`를 가져온 후, 사용자가 데이터를 선택했을 때 `postPopupMessage` 유틸리티 함수를 호출하여 메인 페이지로 메시지를 전송합니다.

    ```tsx
    import { useSearchParams } from "@/lib/hooks/useAppLocation";
    import { postPopupMessage } from "@/lib/popup-bus";

    function CustomerSearchPopupContent() {
      const searchParams = useSearchParams();
      const openerTabId = searchParams.get("openerTabId");

      const handleDataSelect = (selectedData) => {
        if (openerTabId) {
          postPopupMessage({
            targetTabId: openerTabId,
            source: 'customer-search', // 팝업 종류 식별자
            payload: selectedData,     // 전달할 데이터
          });
          window.close();
        } else {
          console.error("Opener Tab ID is missing!");
        }
      };

      // ... (예: DataTable의 onRowDoubleClick 핸들러에서 handleDataSelect 호출)
    }
    ```

### 19.4. 핵심 유틸리티

-   **`lib/popup-bus.ts`**: `BroadcastChannel`을 쉽게 사용할 수 있도록 추상화한 유틸리티 파일입니다. `postPopupMessage`와 `listenForPopupMessages` 두 개의 함수를 제공합니다.

이 방법론을 따르면 React의 복잡한 생명주기나 클로저 문제로부터 자유로운, 안정적이고 예측 가능한 팝업 데이터 연동 기능을 구현할 수 있습니다.

---

## 20. 최근 팝업 및 UI/UX 개선 사항 (Current Enhancements)

최근 업데이트를 통해 애플리케이션의 팝업 시스템이 더욱 견고해지고 다양한 페이지와의 연동이 강화되었으며, 전반적인 UI/UX가 개선되었습니다.

### 20.1. 팝업 데이터 전달 로직 개선

*   **다중 필드 데이터 전달**:
    *   **대손상각대상 관리 페이지 (`bad-debt-management`)**: "고객검색" 팝업에서 선택된 고객의 `실명번호`를 메인 페이지의 "계좌번호" 필드에 자동으로 매핑하도록 수정되었습니다.
    *   **신용회복관리 페이지 (`credit-recovery`)**: "고객검색" 팝업에서 선택된 고객의 `실명번호`를 "주민등록번호"에, `고객명`을 "채무자명" 필드에 자동으로 매핑하도록 확장되었습니다.
    *   **특수채권관리대장 페이지 (`management-ledger`)**: "고객번호" 필터를 통해 "고객검색" 팝업 호출 시, 기존 `고객번호` 외에 페이지에 입력된 `고객명`이 있다면 함께 팝업으로 전달하여 초기 검색 필드로 활용합니다.

*   **문서검색 팝업 연동 강화**:
    *   **개인회생관리 페이지 (`personal-rehabilitation`)**: `RightActions`의 "문서검색" 버튼 클릭 시, "개인회생 원장정보" 탭의 "고객번호" 필드 값을 "문서검색" 팝업으로 정확히 전달하도록 로직을 개선했습니다. 이 과정에서 `RightActions` 컴포넌트 내의 `searchDoc` 액션에 대한 `onClick` 핸들러 오버라이드 문제를 해결하여, 페이지에서 정의된 커스텀 핸들러가 정상적으로 동작하도록 했습니다.
    *   **문서검색 팝업 자체 (`document-search`)**: URL 쿼리 파라미터에서 `customerNumber` 및 `accountNumber`를 받아 초기 필터 상태를 설정하는 로직을 강화하여, 팝업이 호출될 때 검색 조건이 올바르게 반영되도록 했습니다.

*   **거래내역조회 팝업 연동 강화**:
    *   **개인회생관리 페이지 (`personal-rehabilitation`)**: "납입내역" 탭의 "거래내역" 버튼 클릭 시, "조회결과" 테이블에서 선택된 행의 `계좌번호` 값을 "거래내역조회" 팝업의 "계좌번호" 필터로 안정적으로 전달합니다. 이로써 팝업이 열릴 때 관련 계좌 정보가 미리 채워집니다.

*   **수정내역 팝업 양방향 연동**:
    *   **파산면책관리 페이지 (`bankruptcy-exemption`)**: `LeftActions`의 "수정내역" 버튼 클릭 시 `modification-history` 팝업을 호출하며, 팝업 내 테이블 행을 더블 클릭하면 해당 행의 `계좌번호` 및 `신청인고객번호`가 메인 페이지의 상단 "계좌번호" 및 "고객번호" 필터에 자동으로 채워지도록 양방향 데이터 전달 로직을 구현했습니다.

*   **특정 팝업 기능 제어**:
    *   **파산면책관리 페이지 (`bankruptcy-exemption`)**: "고객번호", "신청자명" 필터의 검색 버튼을 통해 "고객검색" 팝업을 열었을 때, 팝업 내의 테이블 행 더블 클릭 시 데이터가 메인 페이지로 전달되지 않도록(`openerTabId` 미전달) 기능을 비활성화했습니다. 이는 해당 컨텍스트에서 팝업이 단순히 조회 목적으로만 사용되도록 하기 위함입니다.
    *   **고객검색 팝업 (`customer-search`)**: `openerTabId`가 없는 상태에서 테이블 행 더블 클릭 시 발생하던 `Opener Tab ID is missing` 콘솔 에러를 더 이상 출력하지 않도록 수정하여, 의도된 비활성화 상황에서 불필요한 오류 메시지가 나타나지 않도록 했습니다.

### 20.2. 필터 UI 및 동작 개선

*   **법무진행 조회 페이지 (`inquiry-legal-proceedings`)**: "고객검색" 필터(`long-search` 타입)에 `{ code: "CUST1000", name: "고객1" }` 형태의 기본값을 설정하여 페이지 로드 시 초기값이 표시되도록 했습니다.
*   **`FilterWrapper` 컴포넌트**: `long-search` 타입 필터의 `value`가 객체(`{ code, name }`)일 때 입력 필드에 `[object Object]` 대신 `name` (또는 `code`) 값이 표시되도록 수정하여 가독성을 높였습니다.

---

## 21. 팝업 관련 에러 해결 과정 (Debugging History)

### 21.1. 문제 1: 초기 접근 시 팝업을 열면 메인 페이지가 새로고침되는 현상

-   **증상**: 캐시가 없는 상태에서 처음 페이지에 진입하여 팝업을 열면, 메인 페이지 전체가 리로드되어 모든 탭 상태가 초기화됨.
-   **원인**: `src/layouts/DashboardLayout.tsx`에 등록된 `beforeunload` 이벤트 핸들러가 `window.open`을 '페이지 이탈'로 잘못 간주하여 발생.
-   **해결**: `DashboardLayout`에서 `beforeunload` 이벤트 리스너를 등록하는 `useEffect` 훅을 완전히 제거하여 문제 해결.

### 21.2. 문제 2: 초기 접근 시 팝업에서 메인 페이지로 데이터 전달이 실패하는 현상

-   **증상**: 페이지 첫 진입 시에만 팝업에서 데이터를 선택해도 메인 페이지의 상태가 업데이트되지 않고 팝업만 닫힘. 새로고침 후에는 정상 동작.
-   **원인**: 'Stale Closure(오래된 클로저)' 문제. 메인 페이지가 리렌더링되면서 `updateFilters`와 같은 함수가 새로 생성되지만, 팝업에 전달된 콜백 함수는 렌더링 이전의 '과거' 함수를 계속 참조하고 있었음.
-   **해결**: `BroadcastChannel` API를 도입하여 메인 페이지와 팝업 간의 통신을 완전히 분리.
    1.  `lib/popup-bus.ts` 유틸리티 생성.
    2.  팝업을 여는 모든 페이지는 `window.open` 시 URL에 `openerTabId`를 포함시키고, `useEffect`에서 `listenForPopupMessages`를 통해 메시지 수신 대기.
    3.  데이터를 전달하는 모든 팝업은 `useSearchParams` (from `@/lib/hooks/useAppLocation`)로 `openerTabId`를 확보한 후, `postPopupMessage`를 통해 데이터를 '방송'.
    4.  이 아키텍처 변경을 통해 React 생명주기와 무관하게 안정적인 데이터 통신을 구현하여 최종적으로 문제 해결.

---

## 22. 신규 페이지 구현 (Bond Adjustment & Special Bond)

### 22.1. 파산면책관리 페이지

-   **페이지 생성**: `src/pages/dashboard/after-loan/bond-adjustment/bankruptcy-exemption/index.tsx` 경로에 "파산면책관리" 페이지가 추가되었습니다.
-   **주요 기능**:
    -   상단의 필터 영역과 하단의 탭 및 상세 정보 영역으로 구성된 표준 레이아웃을 따릅니다.
    -   `customer-search` 팝업과 연동되어 고객 정보를 검색하고 필터에 자동으로 채웁니다.
    -   좌측 `LeftActions`에 "수정내역" 버튼이 추가되었으며, 클릭 시 `modification-history` 팝업을 호출하여 변경 이력을 조회할 수 있습니다.

### 22.2. 특수채권관리대장 페이지

-   **페이지 생성**: `src/pages/dashboard/after-loan/special-bond/management-ledger/index.tsx` 경로에 "특수채권관리대장" 페이지가 추가되었습니다.
-   **고급 UI 구현**:
    -   **멀티 레벨 헤더 테이블**: "편입당시 채권내용"과 "채권회수내용" 등의 상위 헤더 아래에 "원금", "이자", "계" 등의 하위 헤더가 종속된 복잡한 테이블 구조를 `DataTable` 컴포넌트를 확장하여 구현했습니다.
    -   **탭-테이블 통합 레이아웃**: 탭 메뉴 바로 아래에 테이블이 밀착된 형태의 레이아웃을 구현하고, "건수" 표시를 탭 메뉴 우측에 배치하여 공간 효율성을 높였습니다.
    -   **조건부 스타일링**: 그룹 헤더(상위 헤더)에만 박스 형태의 테두리와 배경색을 적용하고, 일반 헤더의 상단 빈 공간에는 테두리를 제거하여 계층 구조를 시각적으로 명확히 표현했습니다.

---

## 23. Axios API 모듈 사용법

`lib/api.ts`에 설정된 `axios` 인스턴스를 사용하여 API 요청을 보낼 수 있습니다.

### 기본 사용법

```typescript
import api from '@/lib/api';

// GET 요청 예시
const fetchData = async () => {
  try {
    const response = await api.get('/users');
    console.log(response.data);
  } catch (error) {
    console.error('Error fetching data:', error);
  }
};

// POST 요청 예시
const createUser = async (userData) => {
  try {
    const response = await api.post('/users', userData);
    console.log('User created:', response.data);
  } catch (error) {
    console.error('Error creating user:', error);
  }
};
```
